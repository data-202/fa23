{
  "hash": "8d1ac7d1f9b4a3b013694289aa3fd9bc",
  "result": {
    "markdown": "---\ntitle: \"DATA 202 - Week 12\"\nsubtitle: \"Bivariate regression analysis (part b)\"\nauthor: \"Nathan Alexander, PhD\"\ninstitute: \"Center for Applied Data Science and Analytics\"\nformat: \n  html: default\n  revealjs:\n    output-file: week12-slides.html\n    height: 900\n    width: 1600\n    smaller: false\n    scrollable: true\n    slide-number: c/t #< collapsed/total\n    logo: \"img/howard-logo.jpg\"\n    footer: \"[Course Data GitHub](https://github.com/data-202)\"\n    toc: false\n    theme: simple\n    echo: true\n    incremental: false\n---\n\n\n\n## Part I: Context\n\nThis week we focus on the General Social Survey data, or GSS. \n\n![General Social Survey](img/wk12-a-1.png)\n\nThis data is located in the `gssr` package in R (see part III). You should become very familiar with the GSS data. Please explore the [website](https://gss.norc.org/) as we will be prioritizing the use of the GSS data for the remainder of our course.\n\nThe use of the GSS data will allow us to consider the meaning of *social justice* in the context of attitudes and beliefs around social issues.\n\n---\n\n## Part II: Content\n\nLet us begin with a set of three variables: $x$, $y$, and $z$.\n\nWe will assume that there is a hypothesized association between all three variables.\n\n\n::: {.cell}\n\n:::\n\n\n---\n\nLet us take a look at the scatterplots between each pair of variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x, y)\n```\n\n::: {.cell-output-display}\n![](week12_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncor(x, y)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.09107752\n```\n:::\n:::\n\n\nTake note of the value of the correlation coefficient.\n\n---\n\nLet us take a look at the scatterplots between each pair of variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x, z)\n```\n\n::: {.cell-output-display}\n![](week12_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncor(x, z)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.9284953\n```\n:::\n:::\n\n\nTake note of the value of the correlation coefficient.\n\n---\n\nLet us take a look at the scatterplots between each pair of variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(y, z)\n```\n\n::: {.cell-output-display}\n![](week12_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncor(y, z)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.04660941\n```\n:::\n:::\n\n\nTake note of the value of the correlation coefficient.\n\n---\n\n### Regression assumptions\n\nIn our previous lectures, we have discussed the function of assumptions and principles in regression analysis. In progressing towards different types of tests, it is important to consider the specific assumptions for any given test.\n\nAnalyzing relationships among social science variables has an assumptions of linearity. However, this assumptions is not always correct. The adoption of this assumption is based on a host of factors. Most notably, that many relationships have been found to be linear when considered in the empirical sense.\n\nSome additional assumptions are as follows:\n\n- The sample is representative of the population \n\n- The variables of interest are normally distributed\n\n- There are no outliers in the data\n\n- Independence\n\n- There is a linear relationship between the independent variable(s) and dependent variable(s)\n\n\n---\n\n# Robust regression analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(ols <- lm(y ~ x + z))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ x + z)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-20.0086  -0.9862   1.0883   2.4747   4.6472 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)\n(Intercept)   1.0975     1.6178   0.678    0.499\nx            -1.5588     1.2180  -1.280    0.204\nz             0.4069     0.4004   1.016    0.312\n\nResidual standard error: 4.192 on 97 degrees of freedom\nMultiple R-squared:  0.01874,\tAdjusted R-squared:  -0.00149 \nF-statistic: 0.9264 on 2 and 97 DF,  p-value: 0.3995\n```\n:::\n:::\n\n\n---\n\n## Part III: Code\n\n---\n\nWe will run through a sample analysis using the `gssr` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install packages\ninstall.packages(\"remotes\", repos = \"http://cran.us.r-project.org\")\ninstall.packages(\"tidyverse\", repos = \"http://cran.us.r-project.org\")\ninstall.packages(\"tidyr\", repos = \"http://cran.us.r-project.org\")\n\n# load gssr package\nremotes::install_github(\"kjhealy/gssr\")\n\n# load libraries\nlibrary(gssr)\nlibrary(dplyr)\nlibrary(tidyr)\n```\n:::\n\n\n---\n\n#### Explore variables in the GSSR documentation file\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load the master documentation files\ndata(gss_all) # note that this is a large file of all GSS data\ndata(gss_doc) # this is the documentation for the GSS data\n```\n:::\n\n\n---\n\n#### Use the GSSR dictionary documentation\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# use the dictionary to get information in a different format\ndata(gss_dict)\ngss_dict\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2,469 × 6\n     pos variable label                           col_type value_labels years   \n   <int> <chr>    <chr>                           <chr>    <chr>        <list>  \n 1     1 wrkstat  labor force status              dbl+lbl  [1] working… <tibble>\n 2     2 hrs1     number of hours worked last we… dbl+lbl  [89] 80+ ho… <tibble>\n 3     3 hrs2     number of hours usually work a… dbl+lbl  [89] 80+ ho… <tibble>\n 4     4 evwork   ever work as long as one year   dbl+lbl  [1] yes; [2… <tibble>\n 5     5 wrkslf   r self-emp or works for somebo… dbl+lbl  [1] self-em… <tibble>\n 6     6 wrkgovt  govt or private employee        dbl+lbl  [1] governm… <tibble>\n 7     7 indus80  r's industry code (1980)        dbl+lbl  [1] strongl… <tibble>\n 8     8 occ10    r's census occupation code (20… dbl+lbl  [10] chief … <tibble>\n 9     9 indus10  r's industry code (naics 2007)  dbl+lbl  [170] crop … <tibble>\n10    10 marital  marital status                  dbl+lbl  [1] married… <tibble>\n# ℹ 2,459 more rows\n```\n:::\n\n```{.r .cell-code}\ngss_dict %>% \n  filter(variable == \"race\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 6\n    pos variable label              col_type value_labels               years   \n  <int> <chr>    <chr>              <chr>    <chr>                      <list>  \n1    71 race     race of respondent dbl+lbl  [1] white; [2] black; [3]… <tibble>\n```\n:::\n\n```{.r .cell-code}\ngss_dict %>% \n  filter(variable == \"sex\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 6\n    pos variable label           col_type value_labels         years            \n  <int> <chr>    <chr>           <chr>    <chr>                <list>           \n1    70 sex      respondents sex dbl+lbl  [1] male; [2] female <tibble [33 × 2]>\n```\n:::\n\n```{.r .cell-code}\ngss_dict %>% \n  filter(variable == \"hrs2\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 6\n    pos variable label                            col_type value_labels years   \n  <int> <chr>    <chr>                            <chr>    <chr>        <list>  \n1     3 hrs2     number of hours usually work a … dbl+lbl  [89] 80+ ho… <tibble>\n```\n:::\n\n```{.r .cell-code}\ngss_dict %>% \n  filter(variable == \"educ\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 6\n    pos variable label                            col_type value_labels years   \n  <int> <chr>    <chr>                            <chr>    <chr>        <list>  \n1    39 educ     highest year of school completed dbl+lbl  [0] no form… <tibble>\n```\n:::\n:::\n\n\n---\n\n#### View information on a specific variable\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# view information on a specific variable\ngss_doc %>% filter(id == \"race\") %>% \n  select(id, description, text)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n  id    description        text                                   \n  <chr> <chr>              <chr>                                  \n1 race  Race of respondent 24. What race do you consider yourself?\n```\n:::\n\n```{.r .cell-code}\ngss_doc %>% filter(id == \"sex\") %>% \n  select(id, description, text)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n  id    description     text                     \n  <chr> <chr>           <chr>                    \n1 sex   Respondents sex 23. Code respondent's sex\n```\n:::\n\n```{.r .cell-code}\ngss_doc %>% filter(id == \"hrs2\") %>% \n  select(id, description, text)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n  id    description                         text                                \n  <chr> <chr>                               <chr>                               \n1 hrs2  Number of hours usually work a week 1b. If with a job, but not at work:…\n```\n:::\n\n```{.r .cell-code}\ngss_doc %>% filter(id == \"educ\") %>% \n  select(id, description, text)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n  id    description                      text                                   \n  <chr> <chr>                            <chr>                                  \n1 educ  Highest year of school completed 15. What is the highest grade in eleme…\n```\n:::\n:::\n\n\n---\n\n#### Examine the years available for any given variable\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# check which years your variables are available\ngss_which_years(gss_all, race)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 33 × 2\n    year race \n   <dbl> <lgl>\n 1  1972 TRUE \n 2  1973 TRUE \n 3  1974 TRUE \n 4  1975 TRUE \n 5  1976 TRUE \n 6  1977 TRUE \n 7  1978 TRUE \n 8  1980 TRUE \n 9  1982 TRUE \n10  1983 TRUE \n# ℹ 23 more rows\n```\n:::\n\n```{.r .cell-code}\ngss_which_years(gss_all, sex)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 33 × 2\n    year sex  \n   <dbl> <lgl>\n 1  1972 TRUE \n 2  1973 TRUE \n 3  1974 TRUE \n 4  1975 TRUE \n 5  1976 TRUE \n 6  1977 TRUE \n 7  1978 TRUE \n 8  1980 TRUE \n 9  1982 TRUE \n10  1983 TRUE \n# ℹ 23 more rows\n```\n:::\n\n```{.r .cell-code}\ngss_which_years(gss_all, hrs2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 33 × 2\n    year hrs2 \n   <dbl> <lgl>\n 1  1972 FALSE\n 2  1973 TRUE \n 3  1974 TRUE \n 4  1975 TRUE \n 5  1976 TRUE \n 6  1977 TRUE \n 7  1978 TRUE \n 8  1980 TRUE \n 9  1982 TRUE \n10  1983 TRUE \n# ℹ 23 more rows\n```\n:::\n\n```{.r .cell-code}\ngss_which_years(gss_all, educ)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 33 × 2\n    year educ \n   <dbl> <lgl>\n 1  1972 TRUE \n 2  1973 TRUE \n 3  1974 TRUE \n 4  1975 TRUE \n 5  1976 TRUE \n 6  1977 TRUE \n 7  1978 TRUE \n 8  1980 TRUE \n 9  1982 TRUE \n10  1983 TRUE \n# ℹ 23 more rows\n```\n:::\n\n```{.r .cell-code}\n# when you want to return information for multiple variables\ngss_all %>%\n  gss_which_years(c(race, sex, hrs2, educ)) %>%\n  print(n = Inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 33 × 5\n    year race  sex   hrs2  educ \n   <dbl> <lgl> <lgl> <lgl> <lgl>\n 1  1972 TRUE  TRUE  FALSE TRUE \n 2  1973 TRUE  TRUE  TRUE  TRUE \n 3  1974 TRUE  TRUE  TRUE  TRUE \n 4  1975 TRUE  TRUE  TRUE  TRUE \n 5  1976 TRUE  TRUE  TRUE  TRUE \n 6  1977 TRUE  TRUE  TRUE  TRUE \n 7  1978 TRUE  TRUE  TRUE  TRUE \n 8  1980 TRUE  TRUE  TRUE  TRUE \n 9  1982 TRUE  TRUE  TRUE  TRUE \n10  1983 TRUE  TRUE  TRUE  TRUE \n11  1984 TRUE  TRUE  TRUE  TRUE \n12  1985 TRUE  TRUE  TRUE  TRUE \n13  1986 TRUE  TRUE  TRUE  TRUE \n14  1987 TRUE  TRUE  TRUE  TRUE \n15  1988 TRUE  TRUE  TRUE  TRUE \n16  1989 TRUE  TRUE  TRUE  TRUE \n17  1990 TRUE  TRUE  TRUE  TRUE \n18  1991 TRUE  TRUE  TRUE  TRUE \n19  1993 TRUE  TRUE  TRUE  TRUE \n20  1994 TRUE  TRUE  TRUE  TRUE \n21  1996 TRUE  TRUE  TRUE  TRUE \n22  1998 TRUE  TRUE  TRUE  TRUE \n23  2000 TRUE  TRUE  TRUE  TRUE \n24  2002 TRUE  TRUE  TRUE  TRUE \n25  2004 TRUE  TRUE  TRUE  TRUE \n26  2006 TRUE  TRUE  TRUE  TRUE \n27  2008 TRUE  TRUE  TRUE  TRUE \n28  2010 TRUE  TRUE  TRUE  TRUE \n29  2012 TRUE  TRUE  TRUE  TRUE \n30  2014 TRUE  TRUE  TRUE  TRUE \n31  2016 TRUE  TRUE  TRUE  TRUE \n32  2018 TRUE  TRUE  TRUE  TRUE \n33  2021 FALSE TRUE  FALSE TRUE \n```\n:::\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get information on the properties of the data\ngss_get_props(varnames = c(\"race\", \"sex\", \"hrs1\", \"educ\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 × 4\n   variable property           value     id   \n   <chr>    <chr>              <chr>     <chr>\n 1 sex      Data type          numeric   SEX  \n 2 sex      Missing-data code  0         SEX  \n 3 sex      Record/column      1/297     SEX  \n 4 race     Data type          numeric   RACE \n 5 race     Missing-data code  0         RACE \n 6 race     Record/column      1/298     RACE \n 7 educ     Data type          numeric   EDUC \n 8 educ     Missing-data codes -1,97-99  EDUC \n 9 educ     Record/columns     1/237-238 EDUC \n10 hrs1     Data type          numeric   HRS1 \n11 hrs1     Missing-data codes -1,98,99  HRS1 \n12 hrs1     Record/columns     1/10-11   HRS1 \n```\n:::\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# loading single year data\ngss12 <- gss_get_yr(2012)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nFetching: https://gss.norc.org/documents/stata/2012_stata.zip\n```\n:::\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# loading panel data by year (not necessary for our course)\ndata(gss_panel08_long) # 2008 three wave panel data (2008, 2010, 2012)\ndata(gss_panel_doc) # loading panel documentation\n```\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# select your variables for a single year using cross sectional file\ngss12 %>% \n  select(race, sex, hrs2, educ, wtssall)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,974 × 5\n   race      sex        hrs2        educ      wtssall  \n   <dbl+lbl> <dbl+lbl>  <dbl+lbl>   <dbl+lbl> <dbl+lbl>\n 1 1 [white] 1 [male]   NA(i) [iap] 16        2.62     \n 2 1 [white] 1 [male]   NA(i) [iap] 12        3.50     \n 3 3 [other] 1 [male]   NA(i) [iap] 12        1.75     \n 4 1 [white] 2 [female] NA(i) [iap] 13        1.24     \n 5 2 [black] 2 [female] NA(i) [iap] 16        0.874    \n 6 1 [white] 2 [female] NA(i) [iap] 19        0.824    \n 7 1 [white] 2 [female] NA(i) [iap] 15        0.824    \n 8 3 [other] 2 [female] NA(i) [iap] 11        0.412    \n 9 2 [black] 2 [female] NA(i) [iap]  9        0.412    \n10 1 [white] 2 [female] NA(i) [iap] 17        0.412    \n# ℹ 1,964 more rows\n```\n:::\n\n```{.r .cell-code}\ngss12 %>% \n  select(race, sex, hrs2, educ, wtssall) %>% \n  count(race, sex, wtssall)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 66 × 4\n   race      sex       wtssall       n\n   <dbl+lbl> <dbl+lbl> <dbl+lbl> <int>\n 1 1 [white] 1 [male]  0.412       167\n 2 1 [white] 1 [male]  0.824       280\n 3 1 [white] 1 [male]  0.874        34\n 4 1 [white] 1 [male]  1.00          1\n 5 1 [white] 1 [male]  1.19          1\n 6 1 [white] 1 [male]  1.24         46\n 7 1 [white] 1 [male]  1.65         22\n 8 1 [white] 1 [male]  1.75         95\n 9 1 [white] 1 [male]  2.06          7\n10 1 [white] 1 [male]  2.62         11\n# ℹ 56 more rows\n```\n:::\n:::\n\n\n---\n\n# Get data via `gss_all` data set\n\nWe can use a more direct method but we must be careful about our outputs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngss_all %>% \n  select(year, race, sex, hrs2, educ, wtssall, wtss, wtssnr) %>% \n  filter(year == 2014) %>% \n  drop_na() -> df\n\nsapply(df, function(x) sum(is.na(x))) # take note that the hrs2 variable will cause issue\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   year    race     sex    hrs2    educ wtssall    wtss  wtssnr \n      0       0       0       0       0       0       0       0 \n```\n:::\n\n```{.r .cell-code}\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 40 × 8\n    year race      sex        hrs2      educ      wtssall  wtss wtssnr\n   <dbl> <dbl+lbl> <dbl+lbl>  <dbl+lbl> <dbl+lbl>   <dbl> <dbl>  <dbl>\n 1  2014 1 [white] 2 [female] 40        16          0.448 0.448  0.500\n 2  2014 2 [black] 2 [female] 50        14          1.38  1.38   1.54 \n 3  2014 3 [other] 2 [female] 50        13          0.448 0.448  0.500\n 4  2014 2 [black] 2 [female] 45        18          0.690 0.690  0.770\n 5  2014 1 [white] 2 [female] 45        17          0.896 0.896  1.00 \n 6  2014 2 [black] 2 [female] 32        12          0.690 0.690  0.735\n 7  2014 3 [other] 2 [female] 40        12          2.07  2.07   2.21 \n 8  2014 1 [white] 2 [female] 15        12          0.896 0.896  0.954\n 9  2014 1 [white] 2 [female] 60        20          0.896 0.896  0.888\n10  2014 1 [white] 1 [male]   40        16          0.896 0.896  0.923\n# ℹ 30 more rows\n```\n:::\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# run your model and diagnostic plots\nmodel2 <- lm(df$educ ~ df$hrs2)\nsummary(model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = df$educ ~ df$hrs2)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-6.2179 -2.8213 -0.1369  1.7238  5.1510 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 14.11117    1.68095   8.395 3.48e-10 ***\ndf$hrs2      0.01845    0.04141   0.445    0.659    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.211 on 38 degrees of freedom\nMultiple R-squared:  0.005195,\tAdjusted R-squared:  -0.02098 \nF-statistic: 0.1984 on 1 and 38 DF,  p-value: 0.6585\n```\n:::\n\n```{.r .cell-code}\n# Plot the regression line\nplot(df$educ, df$hrs2)\nabline(model2, col=\"blue\")\n```\n\n::: {.cell-output-display}\n![](week12_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Check residuals\nresids2 <- residuals(model2)\nplot(df$educ, resids2)\n```\n\n::: {.cell-output-display}\n![](week12_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Diagnostic plots\npar(mfrow=c(2,2))\nplot(model2)\n```\n\n::: {.cell-output-display}\n![](week12_files/figure-html/unnamed-chunk-16-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# Check significance of predictor\nanova(model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: df$educ\n          Df Sum Sq Mean Sq F value Pr(>F)\ndf$hrs2    1   2.05  2.0456  0.1984 0.6585\nResiduals 38 391.73 10.3087               \n```\n:::\n:::\n\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# select your variables for a single year using gss_all\ngss_all %>% \n  filter(year == 2012) %>% \n  select(race, sex, hrs2, educ, wtssall, wtss, wtssnr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,974 × 7\n   race      sex        hrs2      educ      wtssall  wtss wtssnr\n   <dbl+lbl> <dbl+lbl>  <dbl+lbl> <dbl+lbl>   <dbl> <dbl>  <dbl>\n 1 1 [white] 1 [male]   NA(i)     16          2.62  2.62   2.87 \n 2 1 [white] 1 [male]   NA(i)     12          3.50  3.50   3.83 \n 3 3 [other] 1 [male]   NA(i)     12          1.75  1.75   1.91 \n 4 1 [white] 2 [female] NA(i)     13          1.24  1.24   1.35 \n 5 2 [black] 2 [female] NA(i)     16          0.874 0.874  0.957\n 6 1 [white] 2 [female] NA(i)     19          0.824 0.824  0.902\n 7 1 [white] 2 [female] NA(i)     15          0.824 0.824  0.902\n 8 3 [other] 2 [female] NA(i)     11          0.412 0.412  0.451\n 9 2 [black] 2 [female] NA(i)      9          0.412 0.412  0.451\n10 1 [white] 2 [female] NA(i)     17          0.412 0.412  0.451\n# ℹ 1,964 more rows\n```\n:::\n\n```{.r .cell-code}\ngss_all %>% \n  filter(year == 2018) %>% \n  select(race, sex, hrs2, educ, wtssall, wtss, wtssnr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2,348 × 7\n   race      sex        hrs2      educ      wtssall  wtss wtssnr\n   <dbl+lbl> <dbl+lbl>  <dbl+lbl> <dbl+lbl>   <dbl> <dbl>  <dbl>\n 1 1 [white] 1 [male]      41     14          2.36  2.36   2.75 \n 2 1 [white] 2 [female] NA(i)     10          0.943 0.943  1.10 \n 3 1 [white] 1 [male]   NA(i)     16          0.943 0.943  1.10 \n 4 1 [white] 2 [female] NA(i)     16          0.943 0.943  1.10 \n 5 2 [black] 1 [male]   NA(i)     18          0.943 0.943  1.10 \n 6 1 [white] 2 [female] NA(i)     16          0.943 0.943  1.10 \n 7 2 [black] 2 [female] NA(i)     13          0.943 0.943  1.10 \n 8 1 [white] 1 [male]   NA(i)     12          0.471 0.471  0.551\n 9 1 [white] 2 [female] NA(i)      8          0.471 0.471  0.551\n10 1 [white] 1 [male]   NA(i)     12          0.943 0.943  1.10 \n# ℹ 2,338 more rows\n```\n:::\n:::\n\n\n\n---\n\n#### Cleaning data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# clean data for analysis\ngss12 %>% \n  select(race, sex, hrs2, educ, wtssall, wtss, wtssnr) %>% \n  drop_na() -> gss12_analysis\n```\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# check for missing values\nsapply(gss12_analysis, function(x) sum(is.na(x)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   race     sex    hrs2    educ wtssall    wtss  wtssnr \n      0       0       0       0       0       0       0 \n```\n:::\n\n```{.r .cell-code}\nstr(gss12_analysis)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntibble [35 × 7] (S3: tbl_df/tbl/data.frame)\n $ race   : dbl+lbl [1:35] 2, 1, 3, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1...\n   ..@ label       : chr \"race of respondent\"\n   ..@ format.stata: chr \"%29.0g\"\n   ..@ labels      : Named num [1:16] 1 2 3 NA NA NA NA NA NA NA ...\n   .. ..- attr(*, \"names\")= chr [1:16] \"white\" \"black\" \"other\" \"don't know\" ...\n $ sex    : dbl+lbl [1:35] 2, 1, 1, 2, 1, 2, 2, 2, 2, 2, 2, 1, 1, 2, 1, 1, 2, 2, 1...\n   ..@ label       : chr \"respondents sex\"\n   ..@ format.stata: chr \"%29.0g\"\n   ..@ labels      : Named num [1:15] 1 2 NA NA NA NA NA NA NA NA ...\n   .. ..- attr(*, \"names\")= chr [1:15] \"male\" \"female\" \"don't know\" \"iap\" ...\n $ hrs2   : dbl+lbl [1:35] 25, 40, 40, 50, 45, 45, 38, 32, 30, 40, 35, 35, 16, 35,...\n   ..@ label       : chr \"number of hours usually work a week\"\n   ..@ format.stata: chr \"%29.0g\"\n   ..@ labels      : Named num [1:14] 89 NA NA NA NA NA NA NA NA NA ...\n   .. ..- attr(*, \"names\")= chr [1:14] \"89+ hours\" \"don't know\" \"iap\" \"I don't have a job\" ...\n $ educ   : dbl+lbl [1:35] 16, 16, 12, 16, 12, 14, 14, 12, 14, 14,  9, 10, 14, 18,...\n   ..@ label       : chr \"highest year of school completed\"\n   ..@ format.stata: chr \"%29.0g\"\n   ..@ labels      : Named num [1:14] 0 NA NA NA NA NA NA NA NA NA ...\n   .. ..- attr(*, \"names\")= chr [1:14] \"no formal schooling\" \"don't know\" \"iap\" \"I don't have a job\" ...\n $ wtssall: dbl+lbl [1:35] 1.748, 0.824, 3.496, 0.874, 0.824, 0.874, 0.874, 0.412,...\n   ..@ label       : chr \"weight variable\"\n   ..@ format.stata: chr \"%29.0g\"\n   ..@ labels      : Named num [1:13] NA NA NA NA NA NA NA NA NA NA ...\n   .. ..- attr(*, \"names\")= chr [1:13] \"don't know\" \"iap\" \"I don't have a job\" \"dk, na, iap\" ...\n $ wtss   : dbl+lbl [1:35] 1.748, 0.824, 3.496, 0.874, 0.824, 0.874, 0.874, 0.412,...\n   ..@ label       : chr \"weight variable\"\n   ..@ format.stata: chr \"%29.0g\"\n   ..@ labels      : Named num [1:13] NA NA NA NA NA NA NA NA NA NA ...\n   .. ..- attr(*, \"names\")= chr [1:13] \"don't know\" \"iap\" \"I don't have a job\" \"dk, na, iap\" ...\n $ wtssnr : dbl+lbl [1:35] 1.761, 0.845, 3.740, 0.807, 0.887, 0.895, 1.110, 0.408,...\n   ..@ label       : chr \"weight variable\"\n   ..@ format.stata: chr \"%29.0g\"\n   ..@ labels      : Named num [1:13] NA NA NA NA NA NA NA NA NA NA ...\n   .. ..- attr(*, \"names\")= chr [1:13] \"don't know\" \"iap\" \"I don't have a job\" \"dk, na, iap\" ...\n```\n:::\n:::\n\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# exploratory analysis\ngss12 %>% \n  select(race, sex, hrs2, educ, wtssall, wtss, wtssnr) %>% \n  count(race, sex)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  race      sex            n\n  <dbl+lbl> <dbl+lbl>  <int>\n1 1 [white] 1 [male]     673\n2 1 [white] 2 [female]   804\n3 2 [black] 1 [male]     114\n4 2 [black] 2 [female]   187\n5 3 [other] 1 [male]      98\n6 3 [other] 2 [female]    98\n```\n:::\n\n```{.r .cell-code}\ngss12_analysis %>% \n  count(race, sex)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 3\n  race      sex            n\n  <dbl+lbl> <dbl+lbl>  <int>\n1 1 [white] 1 [male]       9\n2 1 [white] 2 [female]    19\n3 2 [black] 2 [female]     5\n4 3 [other] 1 [male]       1\n5 3 [other] 2 [female]     1\n```\n:::\n:::\n\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel <- lm(gss12_analysis$hrs2 ~ gss12_analysis$educ, weight = gss12_analysis$wtssall)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = gss12_analysis$hrs2 ~ gss12_analysis$educ, weights = gss12_analysis$wtssall)\n\nWeighted Residuals:\n    Min      1Q  Median      3Q     Max \n-21.953  -5.699   1.695   5.578  17.203 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)          41.8008     8.0522   5.191 1.05e-05 ***\ngss12_analysis$educ  -0.4010     0.6014  -0.667    0.509    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 10.01 on 33 degrees of freedom\nMultiple R-squared:  0.0133,\tAdjusted R-squared:  -0.0166 \nF-statistic: 0.4447 on 1 and 33 DF,  p-value: 0.5095\n```\n:::\n:::\n\n\n\n---\n\n# Plot the variable relationships \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot the regression line\nplot(gss12_analysis$educ, gss12_analysis$hrs2)\nabline(model, col=\"blue\")\n```\n\n::: {.cell-output-display}\n![](week12_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n---\n\n# Examine residuals\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check residuals\nresids <- residuals(model)\nplot(gss12_analysis$hrs2, resids)\n```\n\n::: {.cell-output-display}\n![](week12_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Diagnostic plots\npar(mfrow=c(2,2))\nplot(model)\n```\n\n::: {.cell-output-display}\n![](week12_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check significance of predictor\nanova(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: gss12_analysis$hrs2\n                    Df Sum Sq Mean Sq F value Pr(>F)\ngss12_analysis$educ  1   44.6  44.575  0.4447 0.5095\nResiduals           33 3307.8 100.236               \n```\n:::\n:::\n\n\n---\n\n# Preview of multivariate analysis\n\nTry to examine the assumptions of the multivariate analysis and model below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## conducting a multivariate linear analysis\nmlm1 <- lm(cbind(hrs2, educ) ~ race + sex, data = df, weight = wtssall)\nsummary(mlm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nResponse hrs2 :\n\nCall:\nlm(formula = hrs2 ~ race + sex, data = df, weights = wtssall)\n\nWeighted Residuals:\n    Min      1Q  Median      3Q     Max \n-25.903  -5.609   2.901   7.820  26.521 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 48.37616    7.68946   6.291 2.54e-07 ***\nrace        -0.01122    3.47654  -0.003    0.997    \nsex         -6.38269    4.44618  -1.436    0.160    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.62 on 37 degrees of freedom\nMultiple R-squared:  0.05918,\tAdjusted R-squared:  0.008322 \nF-statistic: 1.164 on 2 and 37 DF,  p-value: 0.3235\n\n\nResponse educ :\n\nCall:\nlm(formula = educ ~ race + sex, data = df, weights = wtssall)\n\nWeighted Residuals:\n    Min      1Q  Median      3Q     Max \n-5.4129 -2.5731  0.0395  1.4778  5.1925 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  15.6865     1.8605   8.431 3.87e-10 ***\nrace         -2.2122     0.8412  -2.630   0.0124 *  \nsex           1.2441     1.0758   1.156   0.2549    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.054 on 37 degrees of freedom\nMultiple R-squared:  0.1591,\tAdjusted R-squared:  0.1136 \nF-statistic:   3.5 on 2 and 37 DF,  p-value: 0.04054\n```\n:::\n:::\n\n\n#### Next up: Week 13\n",
    "supporting": [
      "week12_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}